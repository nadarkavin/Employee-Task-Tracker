@if (isUserMode && !userService.getCurrentUser()) {
  <div class="user-prompt">
    <h3>Enter Your Name to View Your Tasks</h3>
    <input #nameInput placeholder="Your full name (as assigned by admin)" />
    <button (click)="setUser(nameInput.value)">View My Tasks</button>
  </div>
} @else {
  <h2>{{ isUserMode ? 'My Tasks' : 'All Tasks' }}</h2>

  @if (isUserMode) {
    <p class="current-user">
      Showing tasks for: <strong>{{ userService.getCurrentUser() }}</strong>
      <button (click)="clearUser()" style="margin-left: 10px; font-size: 12px;">(Switch)</button>
    </p>
  }

  @if (tasks.length === 0) {
    <p class="no-tasks">No tasks found.</p>
  }

  @for (task of tasks; track task.id) {
    <div class="task-card" [ngClass]="task.status">
      <div class="task-header">
        <h3>{{ task.title }}</h3>
        <span class="status">{{ task.status }}</span>
      </div>

      <p><b>Assigned To:</b> {{ task.assignedTo }}</p>
      <p><b>Deadline:</b> {{ task.endDate }}</p>

      @if (isUserMode) {
        <div class="actions">
          @if (task.status !== 'COMPLETED') {
            <button class="btn progress" (click)="updateUserStatus(task, 'ON_TRACK')">Mark In Progress</button>
            <button class="btn complete" (click)="updateUserStatus(task, 'COMPLETED')">Mark Completed</button>
          }
        </div>
      } @else {
        <div class="actions">
          <button class="btn edit" (click)="openEdit(task)">Edit</button>
          <button class="btn delete" (click)="openDelete(task)">Delete</button>
        </div>
      }
    </div>
  }

  @if (!isUserMode) {
    <!-- Edit Modal -->
    <div class="modal-backdrop" *ngIf="showEditModal">
      <div class="modal">
        <h3>Edit Task</h3>
        <input [(ngModel)]="selectedTask!.title" placeholder="Task title" />
        <input [(ngModel)]="selectedTask!.assignedTo" placeholder="Employee name" />
        <input type="date" [(ngModel)]="selectedTask!.endDate" />
        <div class="modal-actions">
          <button class="btn save" (click)="saveEdit()">Save</button>
          <button class="btn cancel" (click)="closeModals()">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal-backdrop" *ngIf="showDeleteModal">
      <div class="modal danger">
        <h3>Confirm Delete</h3>
        <p>Are you sure you want to delete this task?</p>
        <div class="modal-actions">
          <button class="btn delete" (click)="confirmDelete()">Yes, Delete</button>
          <button class="btn cancel" (click)="closeModals()">Cancel</button>
        </div>
      </div>
    </div>
  }
}